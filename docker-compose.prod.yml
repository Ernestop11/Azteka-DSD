version: '3.8'

networks:
  azteka_net:
    driver: bridge

services:
  azteka-sales:
    build:
      context: ./apps/sales
      dockerfile: Dockerfile
    image: azteka-sales:latest
    container_name: azteka_sales_prod
    restart: unless-stopped
    env_file:
      - ./apps/sales/.env
    environment:
      - NODE_ENV=production
      - PORT=4102
    ports:
      - "4102:4102"
    networks:
      - azteka_net
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:4102/ || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 5

  printer-service:
    build:
      context: ./printer-service
      dockerfile: Dockerfile
    image: azteka-printer:latest
    container_name: azteka_printer_prod
    restart: unless-stopped
    env_file:
      - ./printer-service/.env
    environment:
      - NODE_ENV=production
      - PORT=4101
    ports:
      - "4101:4101"
    networks:
      - azteka_net
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:4101/health || exit 1"]
      interval: 30s
      timeout: 5s
      retries: 5

# Notes:
# - This compose file intentionally keeps services minimal and isolated in the `azteka_net` network.
# - We map host ports 4102 (azteka) and 4101 (printer) by default â€” change these if a port is already claimed by another app on the VPS.
# - For production you may prefer to use an external Postgres service (not in this compose file). If you want Postgres in Docker, add a db service and set DATABASE_URL accordingly.
# - Use `docker compose -f docker-compose.prod.yml up -d --build` to build and start.
